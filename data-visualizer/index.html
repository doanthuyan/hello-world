<!DOCTYPE html>

<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title> Chart example 1 </title>
    <link rel="stylesheet" href="Treant.css">
    <link rel="stylesheet" href="no-parent.css">
    <script src="data.csv.js"></script>
	<script src="http://code.jquery.com/jquery-3.3.1.slim.js" integrity="sha256-fNXJFIlca05BIO2Y5zh1xrShK3ME+/lYZ0j+ChxX2DA=" crossorigin="anonymous"></script>
	<script src="jquery-csv.js"></script>
	<script src="vendor/raphael.js"></script>
    <script src="Treant.js"></script>
    
    <script src="no-parent.js"></script>
	<script>
	window.addEventListener('load', (event) => {
		loadCSVData();
	});
	var dataMap;
	function loadCSVData(){
		console.log(rawData);
		dataMap =  new Map();
		var result = $.csv.toObjects(rawData,{
						  // separator
						  separator:',',
						  // shows headers
						  headers:true

						});
		console.log(result);
		var chartData = [];
		var config = {
					container: "#OrganiseChart1",
					rootOrientation:  'NORTH', // NORTH || EAST || WEST || SOUTH
					hideRootNode: true,
					// levelSeparation: 30,
					siblingSeparation:   40,
					subTeeSeparation:    30,
					
					connectors: {
						type: 'curve'
					},
					node: {
						HTMLclass: 'nodeExample1'
					}
				};
		var root = {};
		chartData.push(config,root);
		for(index in result){
			console.log(result[index]);
			if (result[index] !== undefined && result[index] !== null) {
				var temp = {stackChildren: true} ;
				temp.HTMLid = result[index].id;temp.text={};
				temp.text.id=result[index].id;
				if(result[index].link !== undefined && result[index].link !== null) {
					//temp.parent = link;
					temp.parent = root;
				}else{
					temp.parent = root;
				}
				if(result[index].age !== undefined && result[index].age !== null) {
					//temp.parent = link;
					temp.text.age = result[index].age;
				}else{
					temp.text.age = 'unknown';
				}
				if(result[index].gender !== undefined && result[index].gender !== null) {
					//temp.parent = link;
					temp.text.gender = result[index].gender;
				}else{
					temp.text.gender = 'unknown';
				}
				if(result[index].dateIn !== undefined && result[index].dateIn !== null) {
					//temp.parent = link;
					temp.text.dateIn = result[index].dateIn;
				}else{
					temp.text.dateIn = 'unknown';
				}if(result[index].status !== undefined && result[index].status !== null) {
					//temp.parent = link;
					temp.text.status = result[index].status;
				}else{
					temp.text.status = 'unknown';
				}
				dataMap.set(result[index].id,temp);
				//TODO: 
				// - assign real parent to each node
				// - add real data to chart
				//chartData.push(temp,);
			}
		}
		new Treant(chartData);
	}
	</script>
</head>
<body>
    <div class="chart" id="OrganiseChart1"></div>
    
    
</body>
</html>